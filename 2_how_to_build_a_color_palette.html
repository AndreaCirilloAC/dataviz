<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />


<meta name="author" content="Andrea Cirillo" />


<title>how to build a color palette from any custom image</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-1.1/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-1.1/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs && document.readyState && document.readyState === "complete") {
   window.setTimeout(function() {
      hljs.initHighlighting();
   }, 0);
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->




<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_').toLowerCase();
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}


.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
  padding-left: 25px;
  text-indent: 0;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>

<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">l'ufizio de l'occhio</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="dataviz_index.html">all things dataviz</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">how to build a color palette from any custom image</h1>
<h4 class="author"><em>Andrea Cirillo</em></h4>
<h4 class="date"><em>17/5/2017</em></h4>

</div>


<div id="how-to-build-a-color-palette-from-any-custom-image" class="section level1">
<h1>how to build a color palette from any custom image</h1>
<div id="and-yeah-there-is-a-package-for-that" class="section level2">
<h2>(and yeah, there is a package for that)</h2>
<p>gancio con storia</p>
<p>[image comparing point and click website with R code]</p>
</div>
<div id="what-you-are-going-to-find-here" class="section level2">
<h2>what you are going to find here</h2>
<p>the post will give you a clear view of how the task was automated, providing detail of the clustering algorithm employed. It will moreover show you a small R package which was developed to ease the application of this process from other users. Finally use cases for the considered algo will be provided, from the most intuitive ggplot2 employment to the more advanced one. ## behind the scenes: k-means for image processing I have to be honest: my first thinking when dealing with this task was not the one I am going to show you. I was actually getting lost following a bad path mad of triples of Red Green and Blues, trying to select from frequency tables the most representative ones. But suddenly, after reading a blog post about k-means algorithm the idea was born: let k-means divide the picture into homogeneous clusters, having each one a “center” constituted by an RGB triple and from this way define a palett representative of the picture itself.</p>
<div id="the-k-means-algorithm" class="section level3">
<h3>the k-means algorithm</h3>
<p>to let you maxmismise the fun coming from the rest of the post we have to see here briefly what the k-means clustering algorithm is. This algo is a way to divide a given set of data into k groups/clusters, where k stands for a number, like usually n does. How do we do that? The basic and elegant way behind the algorythm is: measure the difference between data points and lookf or the clusterisation which minimise this difference within clusters. The typical measure employed ere is the euclidean distance, and particularly the <em>squared euclidean distance</em>. We measure with it the distance between points, and we can expand it from 1 to n dimensions. That is why it turns to be effective with such kind of problems where populations can be pertaining to multidimensional spaces. Making it less wordy, let us look at the formula behind the distance. Given two points of a three dimension space <span class="math inline">\(P=(p_{x},p_{y},p_{z})\)</span> and <span class="math inline">\(Q=(q_{x},q_{y},q_{z})\)</span> this distance is measured as the square of the distance between the three couples of coordinates raised to the second:</p>
<p><span class="math display">\[ {\sqrt  {(p_{x}-q_{x})^{2}+(p_{y}-q_{y})^{2}+(p_{z}-q_{z})^{2}}} \]</span> Now that we know the measure we want to minimize let us have a look at how to find the best possible clusterisation. The typical way adopted from k-means algorithm is working on iterations:</p>
<ul>
<li><em>(a)</em>: first iteration randomically assign a cluster to each data point</li>
<li><em>(b)</em>: then it measure the centroid for every cluster</li>
<li><em>(c)</em>: change cluster assignation moving each data point to the cluster which have the centroid closer to the data point</li>
<li><em>(d)</em>: measure the euclidean distance within clusters and sum it up to measure the performance of the given clusterisation</li>
<li><em>(e)</em>: iterate <em>(b)</em>, <em>(c)</em> and <em>(d)</em> until the last step does not obtain a lower sum of distances.</li>
</ul>
<p>You may be wondering what exactly a centroid it. To get it just think it is the barycenter of a given set of point. It is the point which minimise the euclidean distance between him and the other points within the group. for a given set of <span class="math inline">\(n\)</span> points in a $ ^{n} $ space we measure it as follow:</p>
<p><span class="math display">\[ \mathbf {C} ={\frac {\mathbf {x} _{1}+\mathbf {x} _{2}+\cdots +\mathbf {x} _{n}}{n}} \]</span> Now that we now what a k-means algorithm is, how do we apply it to an image?</p>
</div>
<div id="applying-the-k-means-algorithm-to-an-image" class="section level3">
<h3>applying the k-means algorithm to an image</h3>
<p>getting a closer look to an image, at least its electronic version, we find it can be decomposed into reasonably small points, each of which is of a single vibrant colour. This is what the pointinists thought a long time before pc’s when started paointing on canvas not meshing their colours in greater or smaller colour fields but as small points one next to the other. take for instance this famous painting from seurat:</p>
<p><img src="https://upload.wikimedia.org/wikipedia/commons/0/03/Georges_Seurat_-_Un_dimanche_après-midi_à_l%27île_de_la_Grande_Jatte.jpg" width ="400px"/></p>
<div id="read-the-image" class="section level4">
<h4>read the image</h4>
</div>
<div id="run-k-means" class="section level4">
<h4>run k-means</h4>
</div>
</div>
<div id="dealing-with-results" class="section level3">
<h3>dealing with results</h3>
</div>
<div id="show-the-palette" class="section level3">
<h3>show the palette</h3>
</div>
</div>
<div id="paletter-package-to-replicate-the-process" class="section level2">
<h2>paletter package to replicate the process</h2>
<p>One of the best gifts the R community gave to me is the tons of packages which helped me with nearly every one of my data mining activity. This is why I often try to translate my code into packages, especially when it contains some functions which could be useful for someone. This I think is the case for the processing steps we have seen before, as we will see later on. For this reason you can find on Github a packge named paletter, which is currently with just one not-so-badly documented function. Paletter is freely available (of course…) and you can install it running the following&gt;</p>
<pre class="r"><code>library(devtools)
install_github(&quot;andreacirilloac/paletter&quot;)</code></pre>
<pre><code>## Skipping install of &#39;paletter&#39; from a github remote, the SHA1 (66780b00) has not changed since last install.
##   Use `force = TRUE` to force installation</code></pre>
<p>once you will be done with the installation the actual application of the algo will be even easier, requiring you to run the <em>palette_maker</em> function, which takes as input the path to the picture and the number of colours you are wishing to derive from it:</p>
<pre class="r"><code>library(paletter)
download.file(&quot;https://andreacirilloac.github.io/dataviz/images/sacra_famiglia_canigiani.jpg&quot;, &quot;image.jpg&quot;)
colours_vector &lt;- palette_maker(&quot;image.jpg&quot;, number_of_colors = 32)</code></pre>
<pre><code>## Warning: Quick-TRANSfer stage steps exceeded maximum (= 12397500)</code></pre>
<p><img src="2_how_to_build_a_color_palette_files/figure-html/palette_maker_example-1.png" width="672" /></p>
</div>
<div id="use-cases" class="section level2">
<h2>use cases</h2>
<div id="how-to-use-the-palette-in-ggplot" class="section level3">
<h3>how to use the palette in ggplot</h3>
</div>
<div id="possible-alternative-use-cases" class="section level3">
<h3>possible alternative use cases</h3>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
